<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Aventura 2D Definitiva</title>
<style>
body { margin: 0; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
canvas { display: block; margin: 0 auto; background: #4CAF50; border: 3px solid #333; }
#message {
  position: absolute;
  top: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 5px 15px;
  font-size: 16px;
  border-radius: 5px;
  display: none;
}
#inventory {
  position: absolute;
  bottom: 10px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0,0,0,0.7);
  color: white;
  padding: 5px 10px;
  font-size: 16px;
  border-radius: 5px;
}
#health {
  position: absolute;
  top: 10px;
  right: 20px;
  background: rgba(255,0,0,0.7);
  color: white;
  padding: 5px 10px;
  font-size: 16px;
  border-radius: 5px;
}
</style>
</head>
<body>
<div id="message"></div>
<div id="inventory">Inventario: Vacío</div>
<div id="health">Vida: 100</div>
<canvas id="game" width="700" height="500"></canvas>
<script>
// --- CANVAS ---
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

// --- MENSAJES E INVENTARIO ---
const messageBox = document.getElementById('message');
const inventoryBox = document.getElementById('inventory');
const healthBox = document.getElementById('health');

let inventory = [];
let health = 100;

function showMessage(text){
  messageBox.innerText = text;
  messageBox.style.display = 'block';
  setTimeout(()=>messageBox.style.display='none',2000);
}

function updateInventory(){
  inventoryBox.innerText = "Inventario: " + (inventory.length ? inventory.join(", ") : "Vacío");
}

function updateHealth(){
  healthBox.innerText = "Vida: " + health;
}

// --- JUGADOR ---
const player = { x:50, y:50, w:30, h:30, color:'blue', speed:3 };

// --- TECLAS ---
const keys = {};
document.addEventListener('keydown', e => keys[e.key] = true);
document.addEventListener('keyup', e => keys[e.key] = false);

// --- MAPA (0=suelo,1=pared,2=puerta cerrada) ---
const tileSize=50;
let map=[
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,2,1],
  [1,0,0,0,1,1,0,0,0,1,1,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,1,1,0,1,1,1,1,1,0,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,0,0,1,1,1,1,0,0,1,1,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,0,0,0,0,0,0,0,0,0,0,0,0,1],
  [1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

// --- OBJETOS ---
const items=[
  {x:120,y:100,w:20,h:20,color:'gold',name:'Moneda',collected:false},
  {x:400,y:200,w:20,h:20,color:'red',name:'Poción',collected:false},
  {x:250,y:350,w:20,h:20,color:'purple',name:'Llave',collected:false}
];

// --- NPCS ---
const npcs=[
  {x:500,y:100,w:30,h:30,color:'orange',message:'Hola, aventurero! Necesitarás llaves.'},
  {x:100,y:300,w:30,h:30,color:'pink',message:'Busca objetos para progresar!'}
];

// --- ENEMIGOS ---
const enemies=[
  {x:300,y:150,w:30,h:30,color:'black',damage:10},
  {x:600,y:400,w:30,h:30,color:'darkred',damage:20}
];

// --- FUNCIONES ---
function drawMap(){
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      if(map[y][x]===1){
        ctx.fillStyle='#654321';
        ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
      }
      if(map[y][x]===2){
        ctx.fillStyle='brown';
        ctx.fillRect(x*tileSize, y*tileSize, tileSize, tileSize);
      }
    }
  }
}

function drawPlayer(){
  ctx.fillStyle=player.color;
  ctx.fillRect(player.x, player.y, player.w, player.h);
}

function drawItems(){
  for(const item of items){
    if(!item.collected){
      ctx.fillStyle=item.color;
      ctx.fillRect(item.x,item.y,item.w,item.h);
    }
  }
}

function drawNPCs(){
  for(const npc of npcs){
    ctx.fillStyle=npc.color;
    ctx.fillRect(npc.x,npc.y,npc.w,npc.h);
  }
}

function drawEnemies(){
  for(const e of enemies){
    ctx.fillStyle=e.color;
    ctx.fillRect(e.x,e.y,e.w,e.h);
  }
}

function checkCollisions(newX,newY){
  if(newX<0||newX+player.w>canvas.width) return true;
  if(newY<0||newY+player.h>canvas.height) return true;
  for(let y=0;y<map.length;y++){
    for(let x=0;x<map[y].length;x++){
      if(map[y][x]===1 || map[y][x]===2){
        const wallX=x*tileSize;
        const wallY=y*tileSize;
        if(newX<wallX+tileSize &&
           newX+player.w>wallX &&
           newY<wallY+tileSize &&
           newY+player.h>wallY) return true;
      }
    }
  }
  return false;
}

function updatePlayer(){
  let newX=player.x;
  let newY=player.y;
  if(keys['ArrowUp']||keys['w']) newY-=player.speed;
  if(keys['ArrowDown']||keys['s']) newY+=player.speed;
  if(keys['ArrowLeft']||keys['a']) newX-=player.speed;
  if(keys['ArrowRight']||keys['d']) newX+=player.speed;
  // Puerta
  const doorX=12*tileSize;
  const doorY=1*tileSize;
  if(newX<doorX+tileSize && newX+player.w>doorX && newY<doorY+tileSize && newY+player.h>doorY){
    if(inventory.includes('Llave')){
      map[1][12]=0;
      showMessage('¡Usaste la llave y abriste la puerta!');
      inventory=inventory.filter(i=>'Llave'!==i);
      updateInventory();
    } else {
      return;
    }
  }
  if(!checkCollisions(newX,newY)){ player.x=newX; player.y=newY; }
}

function updateItems(){
  for(const item of items){
    if(!item.collected &&
       player.x<item.x+item.w &&
       player.x+player.w>item.x &&
       player.y<item.y+item.h &&
       player.y+player.h>item.y){
         item.collected=true;
         inventory.push(item.name);
         updateInventory();
         showMessage('¡Recogiste '+item.name+'!');
         if(item.name==='Poción'){
           health=Math.min(100,health+20);
           updateHealth();
         }
       }
  }
}

function updateNPCs(){
  for(const npc of npcs){
    if(player.x< npc.x + npc.w &&
       player.x+player.w> npc.x &&
       player.y< npc.y + npc.h &&
       player.y+player.h> npc.y){
         showMessage(npc.message);
       }
  }
}

function updateEnemies(){
  for(const e of enemies){
    if(player.x< e.x + e.w &&
       player.x+player.w> e.x &&
       player.y< e.y + e.h &&
       player.y+player.h> e.y){
         health-=e.damage;
         if(health<0) health=0;
         updateHealth();
         showMessage('¡Has recibido '+e.damage+' de daño!');
       }
  }
}

// --- LOOP ---
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawMap();
  drawItems();
  drawNPCs();
  drawEnemies();
  drawPlayer();
}

function update(){
  updatePlayer();
  updateItems();
  updateNPCs();
  updateEnemies();
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
